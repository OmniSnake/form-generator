<form [formGroup]="form" (ngSubmit)="onSubmit()">
  <ng-container *ngFor="let field of formConfig">
    <ng-container *ngIf="field.type === 'input'">
      <div *ngIf="field.addable; else singleInput">
        <div [formArrayName]="field.fieldName">
          <div *ngFor="let control of getFormArray(field.fieldName)?.controls; let i = index" class="input-group">
            <app-test-input 
              [label]="field.label + (i + 1)" 
              [required]="field.required" 
              [control]="getFormControlFromArray(field.fieldName, i)!">
            </app-test-input>
            <button *ngIf="i>0" type="button" (click)="removeField(field.fieldName, i)" class="btn btn-danger">Удалить</button>
          </div>
          <button 
            type="button" 
            (click)="addField(field.fieldName, field.maxLength)" 
            [disabled]="getFormArray(field.fieldName)?.length! >= field.maxLength"
            class="btn btn-primary"
          > Добавить поле </button>
        </div>
      </div>
      <ng-template #singleInput>
        <app-test-input 
          [label]="field.label"
          [required]="field.required" 
          [control]="getFormControl(field.fieldName)!">
        </app-test-input>
      </ng-template>
    </ng-container>

    <app-test-select *ngIf="field.type === 'select'" 
      [label]="field.label" 
      [required]="field.required" 
      [choices]="field.choices" 
      [control]="getFormControl(field.fieldName)!"
    ></app-test-select>
    
    <app-test-number *ngIf="field.type === 'number'" 
      [label]="field.label"
      [required]="field.required" 
      [description]="field.description" 
      [control]="getFormControl(field.fieldName)!"
    ></app-test-number>
    
    <app-test-checkbox *ngIf="field.type === 'checkbox'" 
    [label]="field.label" 
    [required]="field.required" 
    [options]="field.options" 
    [control]="getFormArray(field.fieldName)!">
    ></app-test-checkbox>
  
  </ng-container>
  <button type="submit" [disabled]="form.invalid">Отправить</button>
</form>